<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form>
        <textarea id="cityInput"></textarea>
    </form>
    <button id="addCity">Add City</button>
    <div id="weather"></div>
    <div id="cityList"></div>
    

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>//sets the cities array
        var cities = [];
        
        //checks if anything is locally stored
        if (localStorage.getItem("Cities") !== null) {
            cities = JSON.parse(localStorage.getItem("Cities"));
        };
        
        // renders the elements
        function renderElements() {
            $("#cityList").empty();
            for(i = 0; i < cities.length; i++) {
                var city = cities[i];
                //creates necessary elements
                var buttonRemove = $("<button>");
                var buttonSearchCity = $("<button>");
                var div = $("<div>");
        
                // adds necessary classes and ids
                buttonRemove.addClass("removeBtn");
                buttonRemove.attr("id", city);
                buttonRemove.attr("style", "padding: 5px; margin: 5px")
                
                buttonSearchCity.addClass("searchBtn")
                buttonSearchCity.attr("style", "padding: 5px; margin: 5px")
                buttonSearchCity.attr("data-city", city)


                // sets text of elements
                buttonRemove.text("Remove");
                buttonSearchCity.text("Search City")
                div.text(city);
        
                // appends elements
                div.append(buttonRemove);
                div.append(buttonSearchCity);
        
                // sets text to input
                $("#cityList").append(div);
            }
        }
        
        //when the add button is pushed
        $("#addCity").on("click", function() {
            var city = $("#cityInput").val();
            // if the city is already in the array
            if(cities.indexOf(city) !== -1) {
                alert("city already added")
            } else {
                //resets the ingredient input
                $("#cityInput").val("");
        
                //adds ingredient to the array
                cities.push(city);
        
                //stores the new array locally
                localStorage.setItem("Cities", JSON.stringify(cities));
        
                // renders elements
                renderElements();
            }
        });
        
        $(document).on("click", ".removeBtn", function() {
            //removes from array
            var indexOfCity = cities.indexOf($(this).attr("id"));
            cities.splice(indexOfCity, 1);
        
            //stores the new array locally 
            localStorage.setItem("Cities", JSON.stringify(cities));
        
            //renders the array
            renderElements();
        });

        //Searching for the weather in given city
        $(document).on("click", ".searchBtn", function() {
            var city = $(this).attr("data-city");
            var queryURL = "https://openweathermap.org/data/2.5/weather?q=" + city + "&units=metric&appid=b6907d289e10d714a6e88b30761fae22"

            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(function(response) {
                //necessary variables
                var weather = response.data;

                //necessary elements
                var Div = $("<div>");
                var p = $("<p>");
                
                //for me for now
                console.log(response)

                //appends elements
                Div.append(p);
                $("#weather").prepend(Div);
            }
            });
        });
        
        renderElements();
    </script>
</body>
</html>